
db:
	@find support -name "*.cdl" | xargs rm -f
	@./config.status
	@echo "Generating ecos.db file ..."
	@rm -f ecos.db
	@touch ecos.db
	@python ecosdbgen.py >> pkgadd.db
	@if [ -f ecos.db.in ]; then cat ecos.db.in >> pkgadd.db; fi
	@tar -czf support.epk pkgadd.db
	@./ecosadmin.tcl add support.epk
	@rm -f support.epk

clean:
	@echo "Cleaning up..."
	rm -f support.epk pkgadd.db
	find support -name "*.cdl" | xargs rm -f
	rm -f ecos.db

orocos-dist: doc-dist

# After the tgz is made, we remove the 'heavy' files,
# so that packages only contain the html+png version,
# ps/pdf is for online docs.

doc-dist:
	@echo "Making doc tarballs..."
	@for i in $$(find . -name Makefile); do make -C $$(dirname $$i) dist; done
	@rm -rf orocos-docs
	@rm -rf eps
	@mkdir  orocos-docs
	@mkdir  eps
	@echo "Copying..."
	@cp $$(find . -name "*.eps") eps
	@mv $$(find . -name "*.tgz") orocos-docs
	@(cd orocos-docs; tar -cf ../orocos-docs.tar *.tgz )
	@echo "Done !"

html-dist:
	@echo "Making html docs..."
	@for i in $$(find . -name Makefile); do make dochtml -C $$(dirname $$i); done

doc-dist-clean:
	@find . -name "*.pdf" -o -name "*.ps" -o -name "*.eps" | xargs rm

doxy-dist:
	@echo "Running Configure..."
	@./configure >/dev/null || (echo "./configure failed!" ; exit 1)
	@echo "Running Doxygen... (warnings in doxygen.warnings)"
	@rm -rf doc/api
	@mkdir -p doc/api	
	@doxygen >/dev/null || (echo "doxygen failed !" ; exit 1)
	@if [ -d doc ] ; then echo "Tarring API docs..." ;\
	tar -cjf orocos-api.tar.bz2 doc; fi

